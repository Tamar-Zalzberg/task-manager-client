<div class="tasks-container">

  <div class="header-row">
    <button (click)="goBack()" style="background:none; border:none; cursor:pointer; color:#718096;">
      <span style="font-size: 1.5rem;">â†’</span>
    </button>
    <h1>××©×™××•×ª ×”×¤×¨×•×™×§×˜</h1>
  </div>

  <div class="quick-add-task">
    <span style="color: #7b68ee; font-size: 1.5rem;">âŠ•</span>
    <form [formGroup]="taskForm" (ngSubmit)="createTask()" style="flex: 1; display: flex;">
      <input formControlName="title" placeholder="×”×•×¡×£ ××©×™××” ×—×“×©×” ×•×œ×—×¥ Enter...">
    </form>
    <button class="btn-primary" (click)="createTask()" [disabled]="taskForm.invalid" 
      style="background:#7b68ee; color:white; border:none; padding:8px 16px; border-radius:8px; cursor:pointer; font-weight:600;">
      ×©××•×¨
    </button>
  </div>

  <div class="task-list-wrapper" *ngIf="tasks.length > 0">
    <div *ngFor="let task of tasks" class="task-row" [class.completed]="task.status === 'completed'">

      <div class="task-main-info">
        <input type="checkbox" [checked]="task.status === 'completed'" (change)="toggleTaskStatus(task)" 
               style="width: 20px; height: 20px; cursor: pointer; accent-color: #7b68ee;">

        <div class="task-text">
          <span class="task-name">{{ task.title }}</span>
          <span class="task-desc" *ngIf="task.description">{{ task.description | shorten:30 }}</span>
        </div>
      </div>

      <div class="task-actions">
        <button class="comment-btn" (click)="toggleComments(task)" 
                style="background:none; border:none; cursor:pointer; position:relative; font-size: 1.2rem;">
          ğŸ’¬
          <span class="badge" *ngIf="task.comments && task.comments.length > 0">{{ task.comments.length }}</span>
        </button>

        <button class="delete-btn" (click)="deleteTask(task)" 
                style="background:none; border:none; cursor:pointer; font-size: 1.2rem;">
          ğŸ—‘ï¸
        </button>
      </div>

      <div class="task-comments-panel" *ngIf="task.showComments">
        <div class="comments-scroll">
          <div *ngFor="let comment of task.comments" class="comment-bubble">
            <div class="comment-avatar">{{ (comment.user?.username || 'U').charAt(0) }}</div>
            <div class="comment-content">
              <strong>{{ comment.user?.username || '×—×‘×¨ ×¦×•×•×ª' }}</strong>
              <p style="margin: 5px 0 0;">{{ comment.body || comment.content }}</p>
            </div>
          </div>
          <p *ngIf="task.comments.length === 0" style="color: #a0aec0; text-align: center; margin: 10px;">××™×Ÿ ×ª×’×•×‘×•×ª ×¢×“×™×™×Ÿ.</p>
        </div>

        <div class="comment-input-area">
          <input [(ngModel)]="task.newCommentText" placeholder="×›×ª×•×‘ ×ª×’×•×‘×”..." (keyup.enter)="addComment(task)">
          <button (click)="addComment(task)" style="background:none; border:none; cursor:pointer; font-size: 1.2rem;">
            âœˆï¸
          </button>
        </div>
      </div>

    </div>
  </div>

  <div *ngIf="tasks.length === 0" class="empty-state">
    <p style="font-size: 1.2rem;">×”×›×œ ××•×›×Ÿ! ××™×Ÿ ××©×™××•×ª ×¤×ª×•×—×•×ª.</p>
  </div>

</div>